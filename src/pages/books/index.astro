---
import AstroTabs from "@/components/AstroTabs";
import { sanityClient } from "sanity:client";
import BaseLayout from "../layouts/BaseLayout.astro";

const allBooks = await sanityClient.fetch(
  `*[_type == "book" && defined(slug)] | order(publishYear)`
);

const fictionBC = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Fiction" && bc] | order(publishYear desc)`
);

const fictionAD = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Fiction" && (!bc || !defined(bc))] | order(publishYear asc)`
);

const nonfictionBC = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Nonfiction" && bc] | order(publishYear desc)`
);

const nonfictionAD = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Nonfiction" && (!bc || !defined(bc))] | order(publishYear asc)`
);

const dramaBC = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Drama" && bc] | order(publishYear desc)`
);

const dramaAD = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Drama" && (!bc || !defined(bc))] | order(publishYear asc)`
);

const poetryBC = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Poetry" && bc] | order(publishYear desc)`
);

const poetryAD = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Poetry" && (!bc || !defined(bc))] | order(publishYear asc)`
);

const proseBC = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Prose" && bc] | order(publishYear desc)`
);

const proseAD = await sanityClient.fetch(
  `*[_type == "book" && defined(slug) && literaryGenre == "Prose" && (!bc || !defined(bc))] | order(publishYear asc)`
);

const fiction = fictionBC.concat(fictionAD);
const nonfiction = nonfictionBC.concat(nonfictionAD);
const drama = dramaBC.concat(dramaAD);
const poetry = poetryBC.concat(poetryAD);
const prose = proseBC.concat(proseAD);

let tabContent = [fiction, nonfiction, drama, poetry, prose];
---

<BaseLayout>
  <div class="p-5 flex flex-col justify-center m:max-w-2xl lg:max-w-3xl mx-8">
    <h1>Library</h1>

    <AstroTabs
      client:load
      title="Fiction"
      tabNames={["Fiction", "Non-Fiction", "Drama", "Poetry", "Prose"]}
      tabContent={tabContent}
    />

    <!-- <ul>
      {
        allBooks.map((book) => (
          <li>
            <a href={"/books/" + book.slug.current}>{book.name}</a>{" "}
            <span>({book.publishYear})</span>
          </li>
        ))
      }
    </ul> -->
    <div class="flex justify-center py-5 mt-5">
      <a
        href="/"
        class="m-0 border-1 px-2.5 py-1 w-40 text-center hover:bg-black hover:text-slate-50"
        >Back to Home</a
      >
    </div>
  </div>
</BaseLayout>
